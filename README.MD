#Установка модуля#
* Создайте резернвую копию сайта
* Выгрузите проект на сервер, при этом структура модуля в некоторой части повторяет структуру сайта. То поверх перезапишется только файл common_functions.php из директории _local
  Если вы производили модификацию этого файла, то вам нужно будет добавить в свой существующий файл строки: ```include_once __DIR__ . '/eshop/pay_drivers/payqr/categorycarthook.php';```
* Зайдите в администраторскую часть. Далее "Сервис"-> "Драйверы платежных систем" и активируйте опцию "Установить"
Важно! Модуль интегрировался в соответствии с версией Amiro.CMS: "Минимаркет" и "Бизнес".
Для установки сценария popup.js с вашим уникальным merchantid из Личного Кабинета (далее–ЛК) необходимо войти с учетными данными администратора на сайт в панель администратора. Далее "Менеджер сайта" -> "Макет страниц".
В разделе списка страниц выбираем место, где будет размещаться кнопка от PayQR. В соответствии с документацией и функционалом, кнопка располагается в 4-х разделах сайта:
1.	Корзина товаров
2.	Карточка товара
3.	Категория товаров
4.	Главная страница
Соответствующую страницу (wide.css - корзина, home.css – главная страница, catalog.css – каталог товаров, все файлы main.css) редактируем опцией "Редактировать" и в разделе "Формы" переходим во вкладку "HEAD". В поле редактирования вставляем строку из ЛК: 

<script src="https://payqr.ru/popup.js?merchId=xxxxxx-xxxxx"></script>
А также строку javascript-скрипта
<script src="_js/payqronpaidredirect.js "></script>
	Скрипт payqronpaidredirect.js стоит положить в директорию _js, которую найдете в корне сайта. 
Скрипт для взаимодействия с платежной системой payQR payqr_receiver.php должен скопироваться в корень сайта, а в ЛК на него сделать ссылку вида http://вашдомен/payqr_receiver.php
?
Интеграция кнопки

Предварительно необходимо внести в файл размещенный по адресу:
_local/common_functions.php
Следующую строку:
include_once __DIR__ . '/eshop/pay_drivers/payqr/categorycarthook.php';
1.	Интеграция в корзину товаров
Необходимо зайти под администратором и перейти в модуль "Шаблон модулей". Далее находим в фильтре опцию "Модуль" и в ней находим "Каталог товаров: Корзина", а в Тип шаблона выбираем "Сайт" и жмем на пиктограмму "Применить фильтр".
В результатах поиска находим шаблон с названием "eshop_cart.tpl" и нажимаем опцию "редактировать".
Переходим в раздел "Редактировать" и воспользовавшись в форме редактирования текстовым полем "поиск" ищем строки по условию поиска "cart-detailed__make-order-btn". Результат выдаст строку с кнопкой "Оформить заказ". Перед этой кнопкой вставляем наш код:
##setvar @user_id=getCurrentUser()##
##setvar @payqr_button=initPayQRButton('cart', null, user_id)##
##payqr_button##

И далее сохраняем результат. 
2.	Интеграция кнопки в карточку товара и в каталог
Необходимо зайти под администратором и перейти в модуль "Шаблон модулей". Далее находим в фильтре опцию "Модуль" и в ней находим "Каталог товаров: Общие" и "Каталог товаров: Анонс товаров", а в Тип шаблона выбираем "Сайт" и жмем на пиктограмму "Применить фильтр".
В результатах поиска находим шаблон с названием "_eshop_item_list.tpl", а также "eshop_home.tpl" и нажимаем опцию "редактировать".
Переходим в раздел "Редактировать" и воспользовавшись в форме редактирования текстовым полем "поиск" ищем строки по условию поиска:
•	Для шаблона "eshop_home.tpl" ищем по ключевому слову "eshop-item-small__content" и вставляем следующие строки (данными изменениями влияем на отображение кнопки в категории товара)
##setvar @user_id=getCurrentUser()##
##setvar @payqr_button=initPayQRButton('category', itemid, user_id)##
##payqr_button##
•	Для шаблона "_eshop_item_list.tpl" ищем по ключевому слову  "eshop-item-small__content" и вставляем следующие строки в контейнер <div class="ключевое слово">….сюда вставляем следующие строки</div> (данными изменениями влияем на отображение кнопки в категории товара)
##setvar @user_id=getCurrentUser()##
##setvar @payqr_button=initPayQRButton('category', itemid, user_id)##
##payqr_button##

•	Для шаблона "_eshop_item_list.tpl" ищем по ключевому слову "ami-eshop-properties__price-box" (данными изменениями влияем на отображение кнопки в карточке товара)
##setvar @user_id=getCurrentUser()##
##setvar @payqr_button=initPayQRButton('product', itemid, user_id)##
##payqr_button##

И далее сохраняем результат. 
Для более подробной информации стоит обратиться к документации из официальных источников.
Стоит отметить, что Amiro CMS кэширует отображаемые страницы в БД, и чтобы этого не происходило вам необходимо будет либо принудительно очищать таблицы в которых присутствует слово cached, либо в администраторской части отключить кэширование.
Настройка кнопки PayQR

Переходим в раздел "Сервис" -> "Драйвер платежных систем". В списке драйверов вы увидите название драйвера "payqr" и нажмите на кнопку "редактировать". После чего вы сможете настроить кнопку и внести все необходимые реквизиты:
•	PayQR код магазина;
•	PayQR secret key in;
•	PayQR secret key out;
Перечисленные опции вы найдете в личном кабинете по адресу https://payqr.ru/biz/ в разделе "Магазины" -> "Взаимодействие".
Так же в разделе "Взаимодействие" внесите в поле "URL для уведомлений" следующую строчку:
<ваш домен>/payqr_receiver.php
С изменением на ваш действующий домен.

Важное замечание!
В модуле не реализован механизм работы с самовывозом, однако весь каркасный функционал для его интеграции уже присутствует.



